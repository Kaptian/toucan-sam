{% extends "base.html" %}

{% block page_title %}{{ song.title }}{% endblock %}

{% block extra_js %}
    <script src="{{ STATIC_URL }}js/moment-with-langs.js"></script>
{% endblock %}

{% block extra_css %}
<style type="text/css" media="screen">
#embedded {
    width: 100%;
    text-align: center;
}

#cheatsheet {
    width: 100%;
    height: 60px;
}
#cheatsheet-inner {
    width: 100%;
}
#cheatsheet h3 {
    margin: 0;
}

h1 form {
    font-size: large;
}

.scrolling {
    position: fixed;
    top: 51px;
}
.scrolling.pinned {
    position: relative;
}
#time {
    padding-left: 1em;
}
#attic {
    display: none;
}

</style>
{% endblock %}

{% block extra_scripts %}
<script>
$(function(){
    $(window).scroll(function() {
      $('#cheatsheet-inner').toggleClass('scrolling', $(window).scrollTop() + 51 > $('#cheatsheet').offset().top);
        $('#cheatsheet-inner h3').width($('#lyrics').width());
    });
    $(".pin").click(function (event) {
        event.preventDefault();
        $("#cheatsheet-inner").toggleClass("pinned");
        var text = $(event.target).text();
        $(event.target).text(text == "Pin" ? "Unpin" : "Pin");
    });
    var time = 0;
    var timing = false;
    var timer;
    $("#timer").click(function (event) {
        event.preventDefault();
        timing = !timing;
        if (timing) {
            $("#timer").text("Stop Time");
            time = 0;
            update_time(time);
            timer = setInterval(function(){
                time++;
                update_time(time);
            }, 1000);
        } else {
            $("#timer").text("Time it!");
            clearInterval(timer);
            $("#update_time #seconds").val(time);
            $("#update_time").submit();
        }
    });
    function update_time(time) {
        var interval = moment().startOf('day').seconds(time);
        $("#time").text(interval.format('H:mm:ss'));
    }
});
</script>
{% endblock %}


{% block extra_nav_list_items %}
    <li class="smaller">
        <a href="{% url "admin:core_song_change" song.id %}">
            {% if user.is_staff %}
                edit this
            {% endif %}
        </a>
    </li>
{% endblock %}

{% block navbar %}
    {{ block.super }}
{% endblock %}

{% block content %}
    <h1 id="song_title" class="randocolor">
        {{ song.title }}
        <span id="time">{{ song.run_time }}</span>

        {% if user.is_staff %}
        <a href="#" id="timer" class="btn btn-info">Time it!</a>
        <form id="update_time" method="post"> {% csrf_token %}
            <input type="hidden" name="update_time" value="yup"/>
            <input type="hidden" id="seconds" name="seconds" value="0"/>
        </form>
        {% endif %}

        {% if song.proposed and user.is_staff %}
        <form method="post" class="float_right"> {% csrf_token %}
            I'm a proposal!
            <input type="submit" name="accept_proposed" value="Accept me!" class="btn btn-info"/>
        </form>
        {% endif %}
    </h1>

    <h4 class="randocolor">
        {% if song.artist %}
            by {{ song.artist }}
        {% endif %}
        -
        {% if song.singers %}
            sung by {{ song.singers }}
        {% endif %}
        {% if song.video_link %}
            -
            <a href="{{ song.video_link }}">
                fruitorial
            </a>
        {% endif %}
    </h4>
    {% if song.youtube_video_id %}
    <div id="embedded">
        <iframe class="youtube-player" type="text/html" width="640" height="385" src="http://www.youtube.com/embed/{{ song.youtube_video_id }}" allowfullscreen frameborder="0">
        </iframe>
    </div>
    {% endif %}

    {% if song.cheat_sheet %}
        <div id="cheatsheet">
            <div id="cheatsheet-inner" class="pinnable" >
                <h3 class="randocolor">
                    cheat sheet: {{ song.cheat_sheet }}
                    <a href="#" class="pin btn btn-info float_right">Unpin</a>
                </h3>
            </div>
        </div>
    {% endif %}

    <pre id="lyrics">{{ song.lyrics_with_chords }}</pre>

    <div id="attic">

    </div>
{% endblock %}
